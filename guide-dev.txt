// ssh
$ ssh root@blenderkit.com

// run server always
~# forever --minUptime 5 --spinSleepTime 5 start /home/jgravity/presentation-vote/bin/www
// check
~# forever list
// stop
~# forever stop /home/jgravity/presentation-vote/bin/www

// local: run db
$ mongod --dbpath db-local

// local: to use port 80
$ sudo npm start

-------------------

// to solve mongoose problem
# npm remove mongoose
# npm install mongoose@4.10.8 --save

------------------

<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
</head>

<script>
    var phone_db = [
        "010-3755-6890",
        "010-6392-1904",
        "010-7184-5368",
        "010-4748-1802",
        "010-4161-6538",
        "010-5302-5478",
        "010-6787-7704",
        "010-9307-1627",
        "010-7508-6713",
        "010-9879-6858",
        "010-8098-7445",
        "010-3925-9612",
        "010-9307-4723",
        "010-4050-2390",
        "010-7750-6813"
    ];

    var login = null;
    var break_value = 0;

    $(document).ready(function() {
        $(".login-need").hide();

        //메모 쓰기 요청을 처리하는 부분입니다.
        var login = function(contents) {
            var postdata = {
                'user_name': $("#user_name").val(),
                'user_phone': $("#user_phone").val()
            };
        };

        var write = function(contents) {
            var postdata = {
                'user_name': $("#user_name").val(),
                'user_phone': $("#user_phone").val(),
                'user_invest1': $("#user_invest1").val(),
                'user_invest2': $("#user_invest2").val(),
                'user_invest3': $("#user_invest3").val(),
                'user_invest4': $("#user_invest4").val(),
                'user_invest5': $("#user_invest5").val(),
            };

            $.post('/invest', postdata, function() {
                // load();
            });
        };
        
        //쓰기 버튼을 눌렀을 때 쓰기 요청을 발생시키기 위한 부분입니다.
        $("#login_button").click(function(evt) {
            if (phone_db.indexOf($("#user_phone").val()) < 0) {
                alert("등록되지 않은 사용자입니다!");
                alert("폰번호를 양식에 정확히 맞게(ex: 010-3755-6890) 입력하시고, 계속 안 될 경우 디렉터에게 문의해주세요");
            } else {
                $.get('/load', function(data) {
                    $(data).each(function(i) {
                        if (this.user_phone == $("#user_phone").val()) {
                            break_value = 1;
                            alert("이미 투표한 사용자입니다");
                            alert("중복 투표는 불가합니다");
                            location.reload();
                        }
                    });
                    if (break_value == 0) {
                        alert("로그인 성공!");
                        $(".login-need").show();
                        $(".login").prop('disabled', true);

                        $("#invest_button").click(function(evt) {
                            var user_totalinvest = $("#user_invest1").val() * 1 + $("#user_invest2").val() * 1 + $("#user_invest3").val() * 1 + $("#user_invest4").val() * 1 + $("#user_invest5").val() * 1;
                            if (user_totalinvest != 1000) {
                                alert("에러! 총 투자 금액은 정확히 1000 이어야 합니다");
                                alert("현재 투자 금액은 " + user_totalinvest + " 입니다");
                            } else {
                                if ($("#user_invest1").val() * 1 < 0 || $("#user_invest2").val() * 1 < 0 || $("#user_invest3").val() * 1 < 0 || $("#user_invest4").val() * 1 < 0 || $("#user_invest5").val() * 1 < 0) {
                                    alert("에러! 음수 값은 입력할 수 없습니다.");
                                } else {
                                    alert("투표 완료! " + $("#user_name").val() + " 님 감사합니다");
                                    write($("#write textarea").val());
                                    location.reload();
                                }
                            }
                        });
                    }
                });
            }
        });
    });
</script>

<body style="background-color:#333333">
    <header>
        <div class="header-content">
            <div id='main' class="header-content-inner">
                <table id="table-login">
                    <tr class="tr-mainimage">
                        <td colspan="2"><img src="http://via.placeholder.com/300x300"></td>
                    </tr>
                    <tr>
                        <th width="40px"><img src="http://via.placeholder.com/50x50"></th>
                        <td width="200px"><input id='user_name' class='user_name login' type='text' placeholder='이름을 입력하세요' /></td>
                    </tr>
                    <tr style="height: 5px">
                    </tr>
                    <tr>
                        <th><img src="http://via.placeholder.com/50x50"></th>
                        <td><input id='user_phone' class='user_phone login' type='text' placeholder='휴대폰 번호를 입력하세요(- 포함)' /></td>
                    </tr>
                    <tr style="height: 15px">
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input id='login_button' class="btn-primary" type='button' value='로그인' />
                        </td>
                    </tr> 
                </table>
                 <table id="table-invest" class="login-need">
                    <tr class="tr-invest">
                        <th width="160px">1. 밥먹자</th>
                        <td width="80px"><input id='user_invest1' class='user_invest' type='text' placeholder='투자금' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>2. 피엠(PM)</th>
                        <td><input id='user_invest2' class='user_invest' type='text' placeholder='투자금' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>3. FITEEN</th>
                        <td><input id='user_invest3' class='user_invest' type='text' placeholder='투자금' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>4. Peopet</th>
                        <td><input id='user_invest4' class='user_invest' type='text' placeholder='투자금' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>5. 플라시보 미트</th>
                        <td><input id='user_invest5' class='user_invest' type='text' placeholder='투자금' /></td>
                    </tr>
                    <tr style="height: 15px">
                    </tr>
                    <tr class="login-need">
                        <td colspan="2">
                            <input id='invest_button' class="btn-success" type='button' value='투자' />
                        </td>
                    </tr>
                </table> 
            </div>
        </div>
    </header>
    <% include ../partials/body_script %>
</body>

</html>
