<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
        <script>
            var write = null;
            var break_value = 0;
            
            $(document).ready(function() {
                //메모 쓰기 요청을 처리하는 부분입니다.
                var write = function(contents) {
                    var postdata = {
                        'user_name': $("#user_name").val(),
                        'user_phone': $("#user_phone").val(),
                        'user_invest1': $("#user_invest1").val(),
                        'user_invest2': $("#user_invest2").val(),
                        'user_invest3': $("#user_invest3").val(),
                        'user_invest4': $("#user_invest4").val(),
                        'user_invest5': $("#user_invest5").val(),
                        'contents': contents
                    };

                    $.post('/write', postdata, function() {
                        // load();
                    });
                };

                //쓰기 버튼을 눌렀을 때 쓰기 요청을 발생시키기 위한 부분입니다.
                $("#write_button").click(function(evt) {
                    var user_totalinvest = $("#user_invest1").val() * 1 + $("#user_invest2").val() * 1 + $("#user_invest3").val() * 1 + $("#user_invest4").val() * 1 + $("#user_invest5").val() * 1;
                    if (user_totalinvest != 1000) {
                        alert("에러! 총 투자 금액은 정확히 1000 이어야 합니다");
                        alert("현재 투자 금액은 " + user_totalinvest + " 입니다");
                    } else {
                        $.get('/load', function(data) {
                            $(data).each(function(i) {
                                if (this.user_phone == $("#user_phone").val()) {
                                    break_value = 1;
                                    alert("이미 투표한 사용자입니다");
                                    alert("중복 투표는 불가합니다");
                                }
                            });
                            if (break_value == 0) {
                                alert("투표 완료! " + $("#user_name").val() + " 님 감사합니다");
                                write($("#write textarea").val());
                            }
                        });
                    }
                });
            });
        </script>
</head>

<body id="page-top">
    <header>
        <div class="header-content">
            <div id='main' class="header-content-inner">
                <table id='write'>
                    <tr>
                        <th colspan="2">VOTE IT!</th>
                    </tr>
                    <tr>
                        <th>USER NAME</th>
                        <td><input id='user_name' class='user_name' type='text' placeholder='Type here' /></td>
                    </tr>
                    <tr>
                        <th>USER PHONE</th>
                        <td><input id='user_phone' class='user_phone' type='text' placeholder='Type here' /></td>
                    </tr>
                    <tr>
                        <th>USER INVEST</th>
                        <td><input id='user_invest1' class='user_invest' type='text' placeholder='Type here' /></td>
                        <td><input id='user_invest2' class='user_invest' type='text' placeholder='Type here' /></td>
                        <td><input id='user_invest3' class='user_invest' type='text' placeholder='Type here' /></td>
                        <td><input id='user_invest4' class='user_invest' type='text' placeholder='Type here' /></td>
                        <td><input id='user_invest5' class='user_invest' type='text' placeholder='Type here' /></td>
                    </tr>
                    <tr>
                        <th>USER NOTES</th>
                        <td>
                            <textarea placeholder="descriptions about app"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input id='write_button' class="btn btn-primary btn-xl" type='button' value='VOTE!' />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </header>
    <a href="../invest/list" class="btn btn-success btn-xl" id="go_to_list">See all results</a>
    <% include ../partials/body_script %>
</body>

</html>
